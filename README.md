# 🚀 ربات تلگرام فروش کانفیگ VPN

ربات تلگرام پیشرفته برای فروش و مدیریت کانفیگ‌های VPN با پشتیبانی از پنل‌های Marzban

## ✨ ویژگی‌های کلیدی

### 🛡️ امنیت بالا
- **حفاظت از اطلاعات حساس**: تمام کلیدها و رمزهای عبور در فایل `.env` نگهداری می‌شوند
- **اعتبارسنجی ورودی**: تمام ورودی‌های کاربر با Pydantic اعتبارسنجی می‌شوند
- **محدودیت نرخ درخواست**: جلوگیری از spam و حملات DoS
- **SQL Injection Prevention**: استفاده از parameterized queries

### 💼 مدیریت جامع
- **پنل ادمین کامل**: مدیریت پلن‌ها، کاربران، پیام‌ها و تنظیمات
- **چندین پنل Marzban**: پشتیبانی از چندین پنل همزمان
- **سیستم کد تخفیف**: ایجاد و مدیریت کدهای تخفیف
- **بکاپ‌گیری**: تهیه بکاپ از تمام کاربران

### 🎯 تجربه کاربری بهتر
- **رابط کاربری پویا**: پیام‌ها و دکمه‌های قابل تنظیم
- **سیستم تمدید**: تمدید خودکار و یادآوری انقضا
- **کانفیگ تست رایگان**: ارائه سرویس تست محدود
- **ارسال همگانی**: اطلاع‌رسانی به کاربران

## 📋 پیش‌نیازها

- Python 3.8+
- SQLite3 (پیش‌فرض) یا PostgreSQL
- دسترسی به اینترنت برای ارتباط با API تلگرام و پنل‌های Marzban

## 🚀 نصب و راه‌اندازی

### 1. کلون کردن پروژه
```bash
git clone https://github.com/your-repo/vpn-telegram-bot.git
cd vpn-telegram-bot
```

### 2. نصب وابستگی‌ها
```bash
pip install -r requirements.txt
```

### 3. تنظیمات محیط
فایل `.env.example` را کپی کرده و نام آن را به `.env` تغییر دهید:

```bash
cp .env.example .env
```

فایل `.env` را ویرایش کنید:

```env
# Bot Configuration
BOT_TOKEN=your_bot_token_here
ADMIN_ID=your_admin_id_here

# Channel Configuration
CHANNEL_USERNAME=@your_channel_username
CHANNEL_ID=-1001234567890

# Database Configuration
DB_NAME=bot.db

# Security Settings
SECRET_KEY=your_secret_key_here
RATE_LIMIT_PER_MINUTE=30

# Logging Configuration
LOG_LEVEL=INFO
LOG_FILE=bot.log
```

### 4. اجرای ربات
```bash
python bot.py
```

## ⚙️ تنظیمات

### دریافت توکن ربات
1. به [@BotFather](https://t.me/BotFather) در تلگرام پیام دهید
2. دستور `/newbot` را ارسال کنید
3. نام و username ربات را تعیین کنید
4. توکن دریافتی را در `.env` قرار دهید

### تنظیم کانال اجباری
1. کانال خود را ایجاد کنید
2. ربات را به عنوان ادمین به کانال اضافه کنید
3. username کانال و ID آن را در `.env` قرار دهید

### اضافه کردن پنل Marzban
1. از دستور `/admin` استفاده کنید
2. روی "مدیریت پنل‌ها" کلیک کنید
3. "افزودن پنل جدید" را انتخاب کنید
4. اطلاعات پنل را وارد کنید

## 📚 راهنمای استفاده

### برای کاربران عادی
- **خرید کانفیگ**: انتخاب پلن، پرداخت، دریافت کانفیگ
- **سرویس من**: مشاهده کانفیگ‌های فعال و تمدید
- **کانفیگ تست**: دریافت کانفیگ تست رایگان

### برای ادمین
- **مدیریت پلن‌ها**: ایجاد، ویرایش، حذف پلن‌ها
- **بررسی سفارشات**: تایید یا رد سفارشات کاربران
- **مدیریت کاربران**: مشاهده آمار و مدیریت کاربران
- **تنظیمات**: تغییر پیام‌ها، کارت‌ها، تنظیمات عمومی

## 🏗️ ساختار پروژه

```
vpn-telegram-bot/
├── bot.py                 # فایل اصلی ربات
├── config.py             # تنظیمات و پیکربندی
├── database.py           # مدیریت پایگاه داده
├── marzban_api.py        # ارتباط با API مرزبان
├── validators.py         # اعتبارسنجی ورودی‌ها
├── requirements.txt      # وابستگی‌های پایتون
├── .env                 # متغیرهای محیطی (حساس)
├── .env.example         # نمونه فایل تنظیمات
├── README.md            # راهنمای پروژه
└── analysis_report.md   # گزارش تحلیل کد
```

## 🔧 پیکربندی پیشرفته

### تغییر پایگاه داده
برای استفاده از PostgreSQL به جای SQLite:

```python
# در config.py
DB_URL = "postgresql://user:password@localhost/dbname"
```

### تنظیم لاگ‌گیری
```env
LOG_LEVEL=DEBUG  # DEBUG, INFO, WARNING, ERROR
LOG_FILE=logs/bot.log
```

### محدودیت نرخ درخواست
```env
RATE_LIMIT_PER_MINUTE=60  # تعداد درخواست در دقیقه
```

## 🛠️ توسعه و سفارشی‌سازی

### اضافه کردن پیام جدید
1. وارد پنل ادمین شوید
2. "مدیریت پیام‌ها" → "افزودن پیام جدید"
3. نام و محتوای پیام را وارد کنید

### ایجاد دکمه‌های جدید
1. در بخش مدیریت پیام‌ها، پیام مورد نظر را انتخاب کنید
2. "ویرایش دکمه‌ها" → "افزودن دکمه جدید"
3. متن، هدف، و موقعیت دکمه را تعیین کنید

## 🔐 امنیت

### نکات امنیتی مهم
- **هرگز** فایل `.env` را در git قرار ندهید
- توکن ربات را محرمانه نگه دارید
- از HTTPS برای پنل‌های Marzban استفاده کنید
- به‌روزرسانی منظم وابستگی‌ها

### بکاپ‌گیری
```bash
# بکاپ پایگاه داده
cp bot.db backup/bot_$(date +%Y%m%d).db

# بکاپ تنظیمات
cp .env backup/.env_$(date +%Y%m%d)
```

## 📊 نظارت و عیب‌یابی

### بررسی لاگ‌ها
```bash
tail -f bot.log
```

### مشکلات رایج

#### ربات پاسخ نمی‌دهد
- بررسی صحت توکن ربات
- اتصال اینترنت سرور
- وضعیت سرویس‌های تلگرام

#### خطای اتصال به پنل
- بررسی URL پنل
- اعتبار username/password
- دسترسی شبکه به پنل

#### مشکل پایگاه داده
- بررسی مجوزهای فایل
- فضای دیسک کافی
- صحت ساختار جداول

## 🤝 مشارکت

برای مشارکت در توسعه پروژه:

1. پروژه را Fork کنید
2. شاخه جدید ایجاد کنید (`git checkout -b feature/AmazingFeature`)
3. تغییرات را commit کنید (`git commit -m 'Add some AmazingFeature'`)
4. به شاخه push کنید (`git push origin feature/AmazingFeature`)
5. Pull Request ایجاد کنید

## 📄 مجوز

این پروژه تحت مجوز MIT منتشر شده است. برای جزئیات بیشتر فایل `LICENSE` را مطالعه کنید.

## 📞 پشتیبانی

- **مشکلات فنی**: [GitHub Issues](https://github.com/your-repo/issues)
- **سوالات عمومی**: [Telegram Channel](https://t.me/your_channel)
- **مستندات**: [Wiki](https://github.com/your-repo/wiki)

## 🙏 تشکر

- [python-telegram-bot](https://github.com/python-telegram-bot/python-telegram-bot) برای فریمورک عالی
- [Marzban](https://github.com/Gozargah/Marzban) برای پنل مدیریت VPN
- جامعه متن‌باز برای ابزارها و کتابخانه‌های استفاده شده

---

**⚠️ هشدار**: این ربات صرفاً برای اهداف آموزشی و استفاده قانونی طراحی شده است. لطفاً از قوانین محلی و بین‌المللی پیروی کنید.